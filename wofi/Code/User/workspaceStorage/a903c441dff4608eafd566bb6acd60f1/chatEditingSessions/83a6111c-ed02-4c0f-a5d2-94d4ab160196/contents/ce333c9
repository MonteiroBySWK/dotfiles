import { useState, useEffect, useRef, useCallback } from "react";
import TitleSection from "../components/ui/TitleSection";
import type { dataProject } from "../constants/ProjectData";
import image_project from "../assets/image_project.webp";
import { dataProjectArr } from "../constants/ProjectData";
// import { ArrowBigLeft, ArrowBigRight } from "lucide-react";
import Section from "../components/ui/Section";

const checkColorStatus = (status: "FINISHED" | "IN_PROGRESS" | "MODELING") => {
  if (status === "FINISHED") {
    return "text-green-800 bg-green-200 border-green-700";
  }

  if (status === "IN_PROGRESS") {
    return "text-blue-800 bg-blue-200 border-blue-700";
  }

  if (status === "MODELING") {
    return "text-purple-800 bg-purple-200 border-purple-700";
  }
};

const ProjectItem = ({
  data,
  isActive,
  onClick,
}: {
  data: dataProject;
  isActive: boolean;
  onClick: () => void;
}) => {
  return (
    <div
      onClick={onClick}
      className={`flex flex-col md:flex-row border border-border p-4 text-txt-primary w-full flex-shrink-0 transition-all duration-500 cursor-pointer ${
        isActive ? "opacity-100 scale-100" : "opacity-50 scale-90"
      }`}
    >
      <div className="relative w-full md:w-1/3">
        <img
// ... (o resto do componente ProjectItem permanece o mesmo)
// ...
        </a>
      </div>
    </div>
  );
};

export default function NewProjects() {
  const [currentIndex, setCurrentIndex] = useState(0);
// ... (o resto da lógica do componente permanece a mesma)
// ...
  };

  return (
    <Section
      id="projects"
      className="h-screen max-w-7xl flex flex-col items-center justify-center mx-auto"
    >
      <TitleSection>Projetos</TitleSection>

      <div
        className="w-full max-w-5xl mx-auto relative"
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
      >
        <div
          className="flex items-center transition-transform ease-in-out duration-700"
          style={{
            // 1. Centraliza o slide ativo: move o contêiner para a esquerda em 75% do índice.
            //    (70% do slide + 5% de margem)
            // 2. Adiciona um deslocamento para a direita de 12.5% para centralizar o slide de 75% no contêiner.
            transform: `translateX(calc(-${
              currentIndex * 75
            }% + 12.5%))`,
          }}
        >
          {dataProjectArr.map((project, index) => (
            <div
              className="w-full flex-shrink-0"
              style={{ flexBasis: "70%", margin: "0 2.5%" }} // Cada slide ocupa 70% com margens
              key={index}
            >
              <ProjectItem
                data={project}
                isActive={index === currentIndex}
                onClick={() => goToSlide(index)}
              />
            </div>
          ))}
        </div>
      </div>

      <div className="flex justify-center gap-x-2 mt-6">
// ... (o resto do componente permanece o mesmo)
// ...
      </div>
    </Section>
  );
}

export default function NewProjects() {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);
  const touchStartX = useRef(0);

  const nextSlide = useCallback(() => {
    setCurrentIndex((prevIndex) =>
      prevIndex === dataProjectArr.length - 1 ? 0 : prevIndex + 1
    );
  }, []);

  const prevSlide = () => {
    setCurrentIndex((prevIndex) =>
      prevIndex === 0 ? dataProjectArr.length - 1 : prevIndex - 1
    );
  };

  const resetTimeout = () => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
  };

  useEffect(() => {
    resetTimeout();
    if (!isPaused) {
      timeoutRef.current = setTimeout(nextSlide, 5000); // muda a cada 5 segundos
    }

    return () => {
      resetTimeout();
    };
  }, [currentIndex, isPaused, nextSlide]);

  const goToSlide = (slideIndex: number) => {
    setCurrentIndex(slideIndex);
  };

  const handleTouchStart = (e: React.TouchEvent) => {
    touchStartX.current = e.touches[0].clientX;
  };

  const handleTouchMove = (e: React.TouchEvent) => {
    if (touchStartX.current === 0) {
      return;
    }

    const touchEndX = e.touches[0].clientX;
    const diff = touchStartX.current - touchEndX;

    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
      touchStartX.current = 0;
    }
  };

  return (
    <Section
      id="projects"
      className="h-screen max-w-7xl flex flex-col items-center justify-center mx-auto"
    >
      <TitleSection>Projetos</TitleSection>

      <div
        className="w-full max-w-5xl mx-auto overflow-hidden relative"
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
      >
        <div
          className="flex items-center transition-transform ease-in-out duration-700"
          style={{
            transform: `translateX(calc(-${
              currentIndex * 100
            }% - ${currentIndex} * 1rem))`,
          }}
        >
          {dataProjectArr.map((project, index) => (
            <div
              className="w-full flex-shrink-0 px-2"
              style={{ flexBasis: "100%" }}
              key={index}
            >
              <ProjectItem data={project} isActive={index === currentIndex} />
            </div>
          ))}
        </div>
      </div>

      <div className="flex justify-center gap-x-2 mt-6">
        {dataProjectArr.map((_, index) => (
          <div
            key={index}
            onClick={() => goToSlide(index)}
            className={`size-3 rounded-full cursor-pointer transition-all ${
              currentIndex === index ? "bg-primary scale-125" : "bg-gray-500"
            }`}
          ></div>
        ))}
      </div>
    </Section>
  );
}
