<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JTCheck System – Student Dashboard</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons via CDN (para os ícones Calendar e LogOut) -->
  <script src="https://unpkg.com/lucide"></script>
  <style>
    /* Garante que, ao inserir novos elementos via JavaScript, o Lucide os converta para SVG */
    .lucide {
      vertical-align: middle;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- HEADER -->
  <header class="bg-blue-600 text-white shadow-md">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-4 py-4">
      <div>
        <h1 class="text-2xl font-bold">JTCheck System</h1>
        <p class="text-blue-100">Student Dashboard</p>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-right">
          <p id="user-name" class="font-medium">John Doe</p>
          <p id="user-id" class="text-sm text-blue-100">JT0012345</p>
        </div>
        <button
          id="btn-logout"
          class="
            flex items-center gap-2
            bg-blue-700 hover:bg-blue-800 
            text-white text-sm px-3 py-1.5 
            rounded-md border border-blue-500
            transition-colors
          ">
          <!-- Ícone LogOut (será processado pelo Lucide) -->
          <i data-lucide="log-out" class="h-4 w-4"></i>
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-1 max-w-6xl mx-auto px-4 py-6">
    <!-- Cards de Estatísticas -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
      <div class="bg-white rounded-lg shadow p-5">
        <p class="text-sm font-medium text-gray-500">Total Classes</p>
        <p id="total-classes" class="mt-2 text-3xl font-bold">0</p>
      </div>
      <div class="bg-white rounded-lg shadow p-5">
        <p class="text-sm font-medium text-gray-500">Present</p>
        <p id="present-count" class="mt-2 text-3xl font-bold text-green-600">0</p>
      </div>
      <div class="bg-white rounded-lg shadow p-5">
        <p class="text-sm font-medium text-gray-500">Absent</p>
        <p id="absent-count" class="mt-2 text-3xl font-bold text-red-600">0</p>
      </div>
      <div class="bg-white rounded-lg shadow p-5">
        <p class="text-sm font-medium text-gray-500">Attendance Rate</p>
        <p id="attendance-rate" class="mt-2 text-3xl font-bold text-blue-600">0%</p>
      </div>
    </div>

    <!-- Tabela de Registros -->
    <div class="bg-white rounded-lg shadow">
      <div class="flex items-center border-b px-5 py-4">
        <!-- Ícone Calendar -->
        <i data-lucide="calendar" class="h-5 w-5 text-gray-600 mr-2"></i>
        <h2 class="text-lg font-semibold">Your Attendance Records</h2>
      </div>
      <p class="px-5 py-2 text-gray-500">View your complete attendance history</p>

      <div id="records-container" class="p-5">
        <!-- Se não houver registros, mostra mensagem -->
        <p id="no-records-msg" class="text-center text-gray-500 py-10">Loading...</p>
        <!-- A tabela será injetada aqui pelo JS -->
        <div id="records-table-wrapper" class="hidden overflow-x-auto rounded-md border">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
              </tr>
            </thead>
            <tbody id="records-body" class="bg-white divide-y divide-gray-200">
              <!-- Linhas serão injetadas aqui -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- JavaScript -->
  <script>
    // Inicializa Lucide (exibe ícones conforme <i data-lucide="...">)
    document.addEventListener("DOMContentLoaded", () => {
      if (window.lucide) {
        window.lucide.replace();
      }
    });

    // ========== MOCK: Função que retorna dados de presença simulados ==========
    function getMockAttendanceData() {
      return [
        { id: "1", enrollmentId: "JT0012345", date: "2025-05-01T10:00:00Z", status: "present", notes: "" },
        { id: "2", enrollmentId: "JT0012345", date: "2025-05-03T10:00:00Z", status: "absent", notes: "Sick" },
        { id: "3", enrollmentId: "JT0012345", date: "2025-05-05T10:00:00Z", status: "late", notes: "Traffic" },
        { id: "4", enrollmentId: "JT0099999", date: "2025-05-02T10:00:00Z", status: "present", notes: "" },
        // Você pode adicionar mais registros aqui
      ];
    }

    document.addEventListener("DOMContentLoaded", () => {
      // ====== Em vez de autenticar, já definimos um usuário fixo ======
      const userData = {
        id: "JT0012345",
        name: "John Doe",
        type: "student"
      };

      // Preenche o cabeçalho com nome e ID do usuário fixo
      document.getElementById("user-name").innerText = userData.name;
      document.getElementById("user-id").innerText = userData.id;

      // 1) Buscar e filtrar registros de presença pelo enrollmentId
      const allRecords = getMockAttendanceData();
      const attendanceRecords = allRecords.filter(rec => rec.enrollmentId === userData.id);

      // 2) Calcular estatísticas
      const totalClasses = attendanceRecords.length;
      const presentCount = attendanceRecords.filter(r => r.status === "present").length;
      const absentCount = attendanceRecords.filter(r => r.status === "absent").length;
      const lateCount = attendanceRecords.filter(r => r.status === "late").length;
      const attendanceRate = totalClasses > 0 ? Math.round((presentCount / totalClasses) * 100) : 0;

      // 3) Preencher cards de estatísticas
      document.getElementById("total-classes").innerText = totalClasses;
      document.getElementById("present-count").innerText = presentCount;
      document.getElementById("absent-count").innerText = absentCount;
      document.getElementById("attendance-rate").innerText = attendanceRate + "%";

      // 4) Preencher tabela de registros (ou mensagem "No records")
      const noRecordsMsg = document.getElementById("no-records-msg");
      const tableWrapper = document.getElementById("records-table-wrapper");
      const tbody = document.getElementById("records-body");

      if (attendanceRecords.length === 0) {
        noRecordsMsg.innerText = "No attendance records found";
        tableWrapper.classList.add("hidden");
      } else {
        noRecordsMsg.classList.add("hidden");
        tableWrapper.classList.remove("hidden");

        attendanceRecords.forEach(record => {
          const tr = document.createElement("tr");

          // Coluna Date
          const tdDate = document.createElement("td");
          tdDate.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-900";
          const dateObj = new Date(record.date);
          tdDate.innerText = dateObj.toLocaleDateString();
          tr.appendChild(tdDate);

          // Coluna Status (com Badge)
          const tdStatus = document.createElement("td");
          tdStatus.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-900";
          const badge = document.createElement("span");
          badge.classList.add(
            "px-2",
            "inline-flex",
            "text-xs",
            "leading-5",
            "font-semibold",
            "rounded-full"
          );
          if (record.status === "present") {
            badge.classList.add("bg-green-100", "text-green-800");
            badge.innerText = "Present";
          } else if (record.status === "absent") {
            badge.classList.add("bg-red-100", "text-red-800");
            badge.innerText = "Absent";
          } else {
            badge.classList.add("bg-yellow-100", "text-yellow-800");
            badge.innerText = "Late";
          }
          tdStatus.appendChild(badge);
          tr.appendChild(tdStatus);

          // Coluna Notes
          const tdNotes = document.createElement("td");
          tdNotes.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
          tdNotes.innerText = record.notes || "-";
          tr.appendChild(tdNotes);

          tbody.appendChild(tr);
        });
      }

      // 5) Botão de Logout (neste caso só dá um alert, pois não há autenticação real)
      document.getElementById("btn-logout").addEventListener("click", () => {
        alert("Logout clicked. Implemente sua lógica de logout aqui.");
      });
    });
  </script>
</body>
</html>
