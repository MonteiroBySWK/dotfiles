# Sistema de Roteamento e Navegação

## App Router - Next.js 15

O projeto utiliza o novo App Router do Next.js 15 com roteamento baseado em arquivos.

### Estrutura de Rotas

```
src/app/
├── layout.tsx              # Layout raiz
├── page.tsx               # Página inicial (/)
├── globals.css            # Estilos globais
├── login/
│   └── page.tsx          # Página de login (/login)
└── dashboard/
    ├── layout.tsx        # Layout do dashboard
    ├── page.tsx         # Dashboard principal (/dashboard)
    ├── projects/
    │   ├── page.tsx     # Lista de projetos (/dashboard/projects)
    │   └── [id]/
    │       └── page.tsx # Projeto específico (/dashboard/projects/[id])
    ├── team/
    │   ├── page.tsx     # Equipe (/dashboard/team)
    │   └── advanced/
    │       └── page.tsx # Equipe avançada (/dashboard/team/advanced)
    ├── tasks/
    │   └── page.tsx     # Tarefas (/dashboard/tasks)
    ├── clients/
    │   ├── page.tsx     # Clientes (/dashboard/clients)
    │   └── portal/
    │       └── page.tsx # Portal do cliente (/dashboard/clients/portal)
    ├── financial/
    │   └── page.tsx     # Financeiro (/dashboard/financial)
    ├── messages/
    │   └── page.tsx     # Mensagens (/dashboard/messages)
    └── settings/
        └── page.tsx     # Configurações (/dashboard/settings)
```

## Layouts Hierárquicos

### Layout Raiz (`/src/app/layout.tsx`)
```tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="pt-BR">
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
        <StoreProvider>
          <ToastProvider>
            {children}
          </ToastProvider>
        </StoreProvider>
      </body>
    </html>
  )
}
```

**Responsabilidades:**
- Configuração de fontes
- Providers globais (Store, Toast)
- Meta tags básicas
- Configuração de idioma

### Layout do Dashboard (`/src/app/dashboard/layout.tsx`)
```tsx
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <SidebarProvider>
      <AppSidebar />
      <SidebarInset>
        <header>
          <SidebarTrigger />
          <Breadcrumb />
        </header>
        <main>{children}</main>
      </SidebarInset>
    </SidebarProvider>
  )
}
```

**Responsabilidades:**
- Sidebar de navegação
- Header com breadcrumbs
- Container principal
- Trigger para mobile

## Componentes de Navegação

### AppSidebar (`/src/components/app-sidebar.tsx`)

Sidebar principal com navegação hierárquica:

```tsx
const navStructure = {
  dashboard: [
    { title: "Visão Geral", url: "/dashboard", icon: BarChart3 }
  ],
  projectManagement: [
    { 
      title: "Projetos", 
      url: "/dashboard/projects", 
      icon: FolderKanban,
      items: [
        { title: "Todos os Projetos", url: "/dashboard/projects" },
        { title: "Em Andamento", url: "/dashboard/projects?status=active" },
        { title: "Concluídos", url: "/dashboard/projects?status=completed" }
      ]
    },
    {
      title: "Tarefas",
      url: "/dashboard/tasks",
      icon: CheckSquare,
      items: [
        { title: "Minhas Tarefas", url: "/dashboard/tasks/my" },
        { title: "Kanban", url: "/dashboard/tasks/kanban" }
      ]
    }
  ],
  // ... outras seções
}
```

**Funcionalidades:**
- Navegação agrupada por contexto
- Sub-menus expansíveis
- Badges de notificação
- Busca integrada
- Estado colapsível
- Projetos em destaque

### NavMain (`/src/components/nav-main.tsx`)
```tsx
interface NavMainProps {
  items: {
    title: string
    url: string
    icon?: LucideIcon
    isActive?: boolean
    badge?: string
    items?: { title: string; url: string }[]
  }[]
  groupLabel?: string
}
```

**Funcionalidades:**
- Renderização de grupos de navegação
- Indicadores de estado ativo
- Sub-navegação colapsível
- Badges numeriais

### NavProjects (`/src/components/nav-projects.tsx`)
```tsx
interface Project {
  name: string
  url: string
  icon: LucideIcon
  status: 'active' | 'paused' | 'completed'
  progress: number
}
```

**Funcionalidades:**
- Lista de projetos favoritos
- Indicadores de progresso
- Status visual dos projetos
- Acesso rápido

### Breadcrumb (`/src/components/ui/breadcrumb.tsx`)
```tsx
<Breadcrumb>
  <BreadcrumbList>
    <BreadcrumbItem>
      <BreadcrumbLink href="/dashboard">Dashboard</BreadcrumbLink>
    </BreadcrumbItem>
    <BreadcrumbSeparator />
    <BreadcrumbItem>
      <BreadcrumbPage>Projetos</BreadcrumbPage>
    </BreadcrumbItem>
  </BreadcrumbList>
</Breadcrumb>
```

## Autenticação e Proteção de Rotas

### Middleware de Autenticação
```tsx
// src/middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl
  
  // Verificar autenticação para rotas protegidas
  if (pathname.startsWith('/dashboard')) {
    const token = request.cookies.get('auth-token')
    
    if (!token) {
      return NextResponse.redirect(new URL('/login', request.url))
    }
  }
  
  return NextResponse.next()
}

export const config = {
  matcher: ['/dashboard/:path*']
}
```

### Proteção de Páginas
```tsx
"use client"

export default function ProtectedPage() {
  const { user, loading } = useAuthStore()
  const router = useRouter()

  useEffect(() => {
    if (!loading && !user) {
      router.push('/login')
    }
  }, [user, loading, router])

  if (loading) return <LoadingSpinner />
  if (!user) return null

  return <PageContent />
}
```

## Navegação Programática

### useRouter Hook
```tsx
import { useRouter } from 'next/navigation'

const Component = () => {
  const router = useRouter()
  
  const handleNavigation = () => {
    // Navegação simples
    router.push('/dashboard/projects')
    
    // Com query params
    router.push('/dashboard/projects?status=active')
    
    // Substituir histórico
    router.replace('/dashboard')
    
    // Voltar
    router.back()
    
    // Recarregar
    router.refresh()
  }
}
```

### Link Component
```tsx
import Link from 'next/link'

<Link 
  href="/dashboard/projects"
  className="hover:underline"
  prefetch={true}
>
  Ver Projetos
</Link>

// Link dinâmico
<Link href={`/dashboard/projects/${project.id}`}>
  {project.name}
</Link>
```

## Query Parameters e Search Params

### useSearchParams Hook
```tsx
'use client'
import { useSearchParams, useRouter } from 'next/navigation'

const ProjectsPage = () => {
  const searchParams = useSearchParams()
  const router = useRouter()
  
  const status = searchParams.get('status') || 'all'
  const search = searchParams.get('search') || ''
  
  const updateParams = (key: string, value: string) => {
    const params = new URLSearchParams(searchParams)
    params.set(key, value)
    router.push(`/dashboard/projects?${params.toString()}`)
  }
  
  return (
    <div>
      <select onChange={(e) => updateParams('status', e.target.value)}>
        <option value="all">Todos</option>
        <option value="active">Ativos</option>
      </select>
    </div>
  )
}
```

## Estados de Navegação

### Indicadores de Estado Ativo
```tsx
'use client'
import { usePathname } from 'next/navigation'

const NavItem = ({ href, children }) => {
  const pathname = usePathname()
  const isActive = pathname === href
  
  return (
    <Link 
      href={href}
      className={cn(
        "nav-item",
        isActive && "nav-item-active"
      )}
    >
      {children}
    </Link>
  )
}
```

### Loading States
```tsx
'use client'
import { usePathname } from 'next/navigation'
import { useState, useEffect } from 'react'

const NavigationProgress = () => {
  const pathname = usePathname()
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    setLoading(true)
    const timer = setTimeout(() => setLoading(false), 300)
    return () => clearTimeout(timer)
  }, [pathname])
  
  if (!loading) return null
  
  return <LoadingBar />
}
```

## Otimizações de Performance

### Prefetching
```tsx
// Automático para Link components
<Link href="/dashboard/projects" prefetch={true}>
  Projetos
</Link>

// Manual
import { useRouter } from 'next/navigation'

const { prefetch } = useRouter()

useEffect(() => {
  prefetch('/dashboard/projects')
}, [])
```

### Lazy Loading de Rotas
```tsx
import dynamic from 'next/dynamic'

const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <LoadingSpinner />,
  ssr: false
})
```

### Code Splitting por Rota
```tsx
// Cada página é automaticamente dividida
// /dashboard/projects -> projects.js
// /dashboard/team -> team.js
```

## Configurações de Rota

### Metadata API
```tsx
// src/app/dashboard/projects/page.tsx
import { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Projetos | Dashboard',
  description: 'Gerencie seus projetos'
}

export default function ProjectsPage() {
  return <div>Projetos</div>
}
```

### Dynamic Routes
```tsx
// src/app/dashboard/projects/[id]/page.tsx
interface ProjectPageProps {
  params: { id: string }
  searchParams: { [key: string]: string | string[] | undefined }
}

export default function ProjectPage({ params, searchParams }: ProjectPageProps) {
  const { id } = params
  
  return <div>Projeto {id}</div>
}
```

### Route Groups
```tsx
// src/app/dashboard/(projects)/
// └── projects/
//     └── page.tsx
// └── tasks/
//     └── page.tsx

// Ambos compartilham layout sem afetar URL
```

## Responsividade da Navegação

### Mobile Navigation
```tsx
const MobileNav = () => {
  const [open, setOpen] = useState(false)
  
  return (
    <>
      <Button 
        variant="ghost" 
        className="md:hidden"
        onClick={() => setOpen(true)}
      >
        <Menu />
      </Button>
      
      <Sheet open={open} onOpenChange={setOpen}>
        <SheetContent side="left">
          <nav>
            {/* Navigation items */}
          </nav>
        </SheetContent>
      </Sheet>
    </>
  )
}
```

### Responsive Sidebar
```tsx
<Sidebar 
  collapsible="icon"
  className="hidden lg:flex"
>
  {/* Desktop sidebar */}
</Sidebar>

{/* Mobile overlay */}
<div className="lg:hidden">
  <MobileNav />
</div>
```
