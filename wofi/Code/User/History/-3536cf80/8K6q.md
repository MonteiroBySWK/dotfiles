# Instruções de Build

## Pré-requisitos

Antes de começar, certifique-se de ter as seguintes ferramentas instaladas em sua máquina:

  * **Docker**
  * **Docker Compose**
  * **Java 21 (JDK)**
  * **Maven 3.9+**

-----

## Configuração do Ambiente

O projeto utiliza variáveis de ambiente para gerenciar informações sensíveis, como credenciais de banco de dados. Você precisará criar arquivos `.env` para cada ambiente.

1.  **Crie o arquivo de variáveis de ambiente para desenvolvimento:**
    Na raiz do projeto, crie um arquivo chamado `.env.dev` e adicione as seguintes variáveis:

    ```ini
    # Variáveis para o banco de dados MySQL
    MYSQL_ROOT_PASSWORD=sua_senha_dev
    MYSQL_DATABASE=seu_banco_dev
    MYSQL_USER=seu_usuario_dev
    MYSQL_PASSWORD=sua_senha_dev

    # Variáveis para o Spring Boot
    SPRING_DATASOURCE_URL=jdbc:mysql://db:3306/${MYSQL_DATABASE}?allowPublicKeyRetrieval=true&useSSL=false
    SPRING_DATASOURCE_USERNAME=${MYSQL_USER}
    SPRING_DATASOURCE_PASSWORD=${MYSQL_PASSWORD}
    ```

2.  **Crie o arquivo de variáveis de ambiente para produção:**
    Na raiz do projeto, crie um arquivo chamado `.env.prod` e adicione as variáveis com os valores de produção:

    ```ini
    # Variáveis para o banco de dados MySQL
    MYSQL_ROOT_PASSWORD=sua_senha_prod
    MYSQL_DATABASE=seu_banco_prod
    MYSQL_USER=seu_usuario_prod
    MYSQL_PASSWORD=sua_senha_prod

    # Variáveis para o Spring Boot
    SPRING_DATASOURCE_URL=jdbc:mysql://db:3306/${MYSQL_DATABASE}?allowPublicKeyRetrieval=true&useSSL=false
    SPRING_DATASOURCE_USERNAME=${MYSQL_USER}
    SPRING_DATASOURCE_PASSWORD=${MYSQL_PASSWORD}
    ```

**Importante**: Não versionar estes arquivos `.env` no Git. Eles já estão incluídos no arquivo `.gitignore` para sua segurança.

-----

## Modo de Desenvolvimento

O modo de desenvolvimento é otimizado para agilidade, com **hot reloading** ativado. As alterações no código-fonte são detectadas automaticamente, reiniciando a aplicação rapidamente.

1.  **Construa e suba os contêineres:**

    ```bash
    docker-compose -f docker-compose.dev.yml up --build
    ```

      * O `docker-compose.dev.yml` irá construir a aplicação, iniciar os serviços `app` (Spring Boot) e `db` (MySQL) e conectar a aplicação ao banco de dados.

2.  **Acesse a aplicação:**
    Sua aplicação estará acessível em `http://localhost:8080`.

3.  **Para parar os contêineres:**
    Pressione `Ctrl + C` no terminal onde o Docker Compose está rodando. Para remover os contêineres e volumes, use:

    ```bash
    docker-compose -f docker-compose.dev.yml down
    ```

-----

## Modo de Produção

O modo de produção gera uma imagem Docker otimizada, leve e segura. Ele utiliza um **multi-stage build** para copiar apenas o arquivo JAR compilado para um contêiner final, que não contém ferramentas de desenvolvimento ou código-fonte.

1.  **Construa a imagem de produção:**

    ```bash
    docker-compose -f docker-compose.yml up --build
    ```

      * Este comando usa o `Dockerfile` de produção, cria uma imagem final e sobe os contêineres.

2.  **Acesse a aplicação:**
    A aplicação estará acessível em `http://localhost:8080`.

3.  **Para parar e remover os contêineres (produção):**

    ```bash
    docker-compose -f docker-compose.yml down
    ```

-----

## Arquitetura de Configuração

O projeto usa **perfis de ambiente** do Spring Boot para gerenciar as configurações.

  * **`application-dev.yml`**: Configurações para desenvolvimento (`ddl-auto: update`, `devtools` ativado).
  * **`application-prod.yml`**: Configurações para produção (`ddl-auto: none`, logs mais restritos).

O Docker Compose injeta a variável `SPRING_PROFILES_ACTIVE` em cada ambiente (`dev` ou `prod`), garantindo que a configuração correta seja aplicada.